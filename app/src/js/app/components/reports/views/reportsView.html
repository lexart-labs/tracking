<div class="imm-wa__hdr imm-flex">
  <div class="imm-flex-5">
    <h1 class="imm-wa__tit">
      <a class="imm-bc-item">Reportes</a>
    </h1>
  </div>
</div>
<div class="imm-frm__fld">
  <ul class="imm-tabs" ng-init="tabReport = 1">
    <li class="imm-tabs__item" ng-click="tabReport = 1" ng-class="{'imm-tabs__item--selected' : tabReport == 1}">
      Reportes Tareas
    </li>
    <li class="imm-tabs__item" ng-click="tabReport = 2" ng-class="{'imm-tabs__item--selected' : tabReport == 2}">
      Reportes Proyectos
    </li>
  </ul>
</div>
<div ng-if="tabReport == 1">
  <div class="imm-wa__cnt">
    <div class="imm-frm__fldgrp">
      <div class="imm-frm__fld">
        <label class="imm-frm__lbl">
          <b class="imm-frm__lbl-name">{{ 'reports.start_time' | translate }}</b>
          <div moment-picker="filter.startTime" max-date="filter.startDate.maxDate">
            <input ng-model="filter.startTime" />
          </div>
        </label>
      </div>

      <div class="imm-frm__fld">
        <label class="imm-frm__lbl">
          <b class="imm-frm__lbl-name">{{ 'reports.end_time' | translate }}</b>
          <div moment-picker="filter.endTime" max-date="filter.endDate.maxDate" min-date="filter.startTime">
            <input ng-model="filter.endTime" />
          </div>
        </label>
      </div>

      <div class="imm-frm__fld" ng-if="userRole=='admin' || userRole == 'pm' ">
        <label class="imm-frm__lbl">
          <b class="imm-frm__lbl-name">{{ 'reports.user' | translate }}</b>
          <ui-select ng-model="filter.idUser" class="imm-select imm-select--input" theme="selectize"
            title="{{ 'reports.users' | translate }}" append-to-body="true">
            <ui-select-match> {{$select.selected.name}} </ui-select-match>
            <ui-select-choices repeat="user.id as user in users | filter: $select.search">
              <div ng-bind-html="user.name | highlight: $select.search"></div>
            </ui-select-choices>
          </ui-select>
        </label>
      </div>

      <div class="imm-frm__fld">
        <label class="imm-frm__lbl">
          <b class="imm-frm__lbl-name">{{ 'reports.client' | translate }}</b>
          <ui-select ng-if="isClient=='false'" ng-model="filter.idClient" class="imm-select imm-select--input"
            theme="selectize" title="{{ 'reports.clients' | translate }}" append-to-body="true"
            ng-change="getProjects(filter.idClient)">
            <ui-select-match> {{$select.selected.name}} </ui-select-match>
            <ui-select-choices repeat="client.id as client in clients | filter: $select.search">
              <div ng-bind-html="client.name | highlight: $select.search"></div>
            </ui-select-choices>
          </ui-select>
          <input ng-if="isClient=='true'" type="text" ng-value="client.name" readonly />
        </label>
      </div>

      <div class="imm-frm__fld">
        <label class="imm-frm__lbl">
          <b class="imm-frm__lbl-name">{{ 'reports.project' | translate }}</b>
          <ui-select ng-model="filter.idProject" class="imm-select imm-select--input" theme="selectize"
            title="{{ 'reports.projects' | translate }}" append-to-body="true">
            <ui-select-match> {{$select.selected.name}} </ui-select-match>
            <ui-select-choices repeat="project.id as project in projects | filter: $select.search">
              <div ng-bind-html="project.name | highlight: $select.search"></div>
            </ui-select-choices>
          </ui-select>
        </label>
      </div>

      <div class="imm-frm__fld">
        <label class="imm-frm__lbl">
          <button class="imm-btn" ng-click="search()" id="buscar">
            {{ 'reports.search' | translate }}
          </button>
        </label>
      </div>
    </div>
    <div class="imm-frm__fld">
      <a style="display: none" download="{{excelName}}.xls" href="#/app/reports"
        onclick="return ngTableExcelExport.excel(this, 'datatable', 'prueba');" style="float: right">
        <button>
          <img class="img_exportExcel" src="/assets/images/exportExcel.png"
            style="vertical-align: middle; margin: 0 5px" />Exportar
        </button>
      </a>
      <ul class="imm-tabs" ng-init="itemTab = 1">
        <li class="imm-tabs__item" ng-click="itemTab = 1" ng-class="{'imm-tabs__item--selected' : itemTab == 1}">
          Tabla
        </li>
        <li class="imm-tabs__item" ng-click="itemTab = 2" ng-class="{'imm-tabs__item--selected' : itemTab == 2}">
          Gr√°ficas
        </li>
      </ul>
    </div>

    <!-- Table -->
    <div class="imm-wa__hdr imm-flex" ng-if="itemTab == 1">
      <div class="imm-flex-5">
        <h1 class="imm-wa__tit">
          <a class="imm-bc-item" ng-if="tracks.length">{{ 'reports.title' | translate }}</a>
        </h1>
        <button class="imm-btn" ng-if="tracks.length" ng-click="exportToCSV()">
          Descargar CSV
        </button>
        <!-- <button
          class="imm-btn"
          ng-if="tracks.length"
          ng-click="exportToExcel('#exportReport')"
        >
          Descargar Excel
        </button> -->
      </div>
    </div>
    <div class="imm-wa__cnt">
      <div class="imm-flex" ng-if="itemTab == 1">
        <div class="flex-table" ng-if="tableTrack.length">
          <div class="flex-head">
            <div class="flex-item">{{ 'reports.user' | translate }}</div>
            <div class="flex-item">{{ 'reports.client' | translate }}</div>
            <div class="flex-item">{{ 'reports.project' | translate }}</div>
            <div ng-if="userRole != 'admin'" class="flex-item"> </div>
            <div class="flex-item">{{ 'reports.task' | translate }}</div>
            <div class="flex-item">{{ 'reports.start_time' | translate }}</div>
            <div class="flex-item">{{ 'reports.end_time' | translate }}</div>
            <div class="flex-item">{{ 'reports.duration' | translate }}</div>
            <div class="flex-item">{{ 'reports.trackCost' | translate }}</div>
            <div style="flex: 5%; width: 5%"></div>
          </div>
          <!-- ORDENADO POR USUARIO -->
          <div ng-repeat="tracks in tableTrack" class="flex-column" style="color: black">
            <!-- ORDENADO POR TAREA -->
            <div ng-repeat="byTask in tracks.byTask" class="flex-column">
              <!-- TRACKS -->
              <div ng-repeat="track in byTask.tracks track by $index" class="flex-column-wrap" id="datatable">
                <div class="flex-row">
                  <div class="flex-item">{{track.userName}}</div>
                  <div class="flex-item">{{track.clientName}}</div>
                  <div class="flex-item" ng-if="userRole != 'admin'">{{track.projectName | truncateTail:true:20:'...'}}
                  </div>
                  <div class="flex-item"><a ng-if="userRole == 'admin'"
                      style="color: #4a90e2; text-decoration: underline"
                      ui-sref="app.projectEdit({id: track.idProyecto})" target="_blank">{{track.projectName |
                      truncateTail:true:20:'...'}}</a></div>
                  <div class="flex-item">
                    {{track.taskName | truncateTail:true:20:'...'}}
                  </div>
                  <div class="flex-item">
                    {{track.startTime | date:'dd/MM/yyyy HH:mm' }}
                  </div>
                  <!-- <div class="flex-item">
                    {{track.endTime ? track.endTime : '' | date:'dd/MM/yyyy
                    HH:mm' }}
                  </div> -->
                  <div class="flex-item">
                    {{track.endTime ? track.endTime : '' | date:'dd/MM/yyyy HH:mm'}}
                  </div>
                  <div class="flex-item">{{track.duration}}</div>
                  <div class="flex-item">{{track.currency}} {{track.trackCost.toFixed(2)}}</div>
                  <!-- <div class="flex-item">$ {{track}}</div> -->
                  <div style="flex: 5%; width: 5%">
                    <a href="" ng-click="editTrack(track)">
                      <i class="ri-pencil-line"></i>
                    </a>
                  </div>
                </div>
                <!-- ADD FEATURE: SUBTOTAL POR TAREAS -->
                <div class="flex-row" ng-if="$index == byTask.tracks.length - 1 && !filter.idTask" style="
                    background-color: rgba(225, 56, 107, 0.1);
                    font-weight: bold;
                  ">
                  <div class="flex-item"></div>
                  <div class="flex-item"></div>
                  <div class="flex-item"></div>
                  <div class="flex-item"></div>
                  <div ng-if="userRole!='admin'" class="flex-item"></div>
                  <div class="flex-item">TAREA</div>
                  <div class="flex-item">
                    {{byTask.taskName | truncateTail:true:20:'...'}}
                  </div>
                  <div class="flex-item">{{byTask.duration}}</div>
                  <div class="flex-item">{{track.currency}} {{byTask.subTotalCost.toFixed(2)}}</div>
                  <div style="flex: 5%; width: 5%"></div>
                </div>
              </div>
            </div>
            <!-- SUBTOTAL POR PROYECTO -->
            <div ng-repeat="byProject in tracks.byProject" class="flex-column">
              <div ng-repeat="track in byProject.tracks track by $index" class="flex-column-wrap" id="datatable">
                <div class="flex-column-wrap">
                  <div ng-if="$index == byProject.tracks.length - 1 && !filter.idTask" class="flex-row" style="
                      background-color: rgb(255, 243, 115);
                      font-weight: bold;
                    ">
                    <div class="flex-item"></div>
                    <div class="flex-item"></div>
                    <div class="flex-item"></div>
                    <div class="flex-item"></div>
                    <div class="flex-item">PROYECTO</div>
                    <div class="flex-item">
                      {{ byProject.projectName | truncateTail:true:20:'...' }}
                    </div>
                    <div class="flex-item">{{byProject.duration}}</div>
                    <div class="flex-item">{{track.currency}} {{byProject.subTotalCost.toFixed(2)}}</div>
                    <div style="flex: 5%; width: 5%"></div>
                  </div>
                </div>
              </div>
            </div>
            <!-- </div> -->
            <!-- SUBTOTAL POR USUARIO -->
            <div class="flex-column" ng-if="userRole=='admin' || userRole == 'pm' && !filter.idUser "
              ng-repeat="track in tracks.tracks">
              <div class="flex-column-wrap">
                <div class="flex-row" style="
                    background-color: rgba(60, 144, 190, 0.1);
                    font-weight: bold;
                  " ng-show="$first">
                  <div class="flex-item"></div>
                  <div class="flex-item"></div>
                  <div class="flex-item"></div>
                  <div class="flex-item"></div>
                  <div class="flex-item"></div>
                  <div class="flex-item">
                    {{ 'reports.sub_total' | translate | uppercase }}
                  </div>
                  <div class="flex-item">{{tracks.duration}}</div>
                  <div class="flex-item">{{track.currency}} {{tracks.subTotalCost.toFixed(2)}}</div>
                  <div style="flex: 5%; width: 5%"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="flex-column">
            <div class="flex-column-wrap">
              <div class="flex-row" style="
                  background-color: rgba(59, 144, 190, 0.43);
                  font-weight: bold;
                ">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{ 'reports.total' | translate | uppercase }}
                </div>
                <div class="flex-item">{{total}}</div>
                <div class="flex-item"> $ {{totalcost.toFixed(2)}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div> -->
        </div>
        <div ng-if="tracks.length" style="display: none">
          <!-- <div ng-if="tracks.length"> -->
          <table id="exportReport" ng-repeat="tracks in tableTrack" style="margin-top: 0">
            <thead ng-if="$first">
              <tr>
                <th>{{ 'reports.user' | translate }}</th>
                <th>{{ 'reports.client' | translate }}</th>
                <th>{{ 'reports.project' | translate }}</th>
                <th>{{ 'reports.task' | translate }}</th>
                <th>{{ 'reports.start_time' | translate }}</th>
                <th>{{ 'reports.end_time' | translate }}</th>
                <th>{{ 'reports.duration' | translate }}</th>
                <th>{{ 'reports.trackCost' | translate }}</th>
                <th class="imm-cstm__grid-5"></th>
              </tr>
            </thead>
            <tbody ng-repeat="byTask in tracks.byTask">
              <tr ng-repeat="track in byTask.tracks track by $index"
                ng-class="{'active-task': track.type != 'projectInfo' && !track.endTime || track.endTime == '0000-00-00 00:00:00'}">
                <td>{{track.userName}}</td>
                <td>{{track.clientName}}</td>
                <td>{{track.projectName | truncateTail:true:20:'...'}}</td>
                <td>{{track.taskName | truncateTail:true:20:'...'}}</td>
                <td>{{track.startTime | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>
                  {{track.endTime ? track.endTime : '' | date:'dd/MM/yyyy HH:mm'
                  }}
                </td>
                <td>{{track.duration}}</td>
                <td>$ {{track.trackCost}}</td>
                <td>
                  <a href="" ng-click="editTrack(track)">
                    <i class="ri-pencil-line"></i>
                  </a>
                </td>
              </tr>
              <tr style="
                  background-color: rgba(225, 56, 107, 0.1);
                  font-weight: bold;
                ">
                <td colspan="4"></td>
                <td>TAREA</td>
                <td>{{byTask.taskName | truncateTail:true:20:'...'}}</td>
                <td>{{byTask.duration}}</td>
                <td>$ {{byTask.subTotalCost}}</td>
                <td></td>
              </tr>
            </tbody>
            <tfoot>
              <tr ng-if="userRole=='admin' || userRole == 'pm' && filter.idUser " style="
                  background-color: rgba(60, 144, 190, 0.1);
                  font-weight: bold;
                ">
                <td colspan="5"></td>
                <td>{{ 'reports.sub_total' | translate | uppercase }}</td>
                <td>{{tracks.duration}}</td>
                <td>$ {{tracks.subTotalCost}}</td>
                <td></td>
              </tr>
            </tfoot>
            <tbody ng-repeat="byProject in tracks.byProject" class="flex-column">
              <table ng-repeat="track in byProject.tracks track by $index" class="flex-column-wrap" id="datatable">
                <tr ng-if="$index == byProject.tracks.length - 1 && !filter.idTask" class="flex-row" style="
                      background-color: rgb(255, 243, 115);
                      font-weight: bold;
                    ">
                  <td class="flex-item"></td>
                  <td class="flex-item"></td>
                  <td class="flex-item"></td>
                  <td class="flex-item"></td>
                  <td class="flex-item">PROYECTO</td>
                  <td class="flex-item">
                    {{ byProject.projectName | truncateTail:true:20:'...' }}
                  </td>
                  <td class="flex-item">{{byProject.duration}}</td>
                  <td class="flex-item">$ {{byProject.subTotalCost}}</td>
                  <td style="flex: 5%; width: 5%"></td>
                </tr>
        </div>
        </table>
        </tbody>
        <!-- <tfoot>
          <tr style="
                  background-color: rgba(104, 149, 191, 0.4);
                  font-weight: bold;
                ">
            <td colspan="5"></td>
            <td>{{ 'reports.total' | translate | uppercase }}</td>
            <td>{{total}}</td>
            <td>$ {{totalcost.toFixed(2)}}</td>
            <td></td>
          </tr>
        </tfoot> -->
        </table>
      </div>
    </div>
    <div ng-if="itemTab == 1">
      <br />
      <a class="imm-bc-item" ng-if="autoTracks.length">{{ 'reports.titleAuto' | translate }}</a>
      <br /><br />
    </div>
    <div class="imm-flex" ng-if="itemTab == 1">
      <div class="flex-table" ng-if="tableTrackAuto.length > 0">
        <div class="flex-head">
          <div class="flex-item">{{ 'reports.user' | translate }}</div>
          <div class="flex-item">{{ 'reports.client' | translate }}</div>
          <div class="flex-item">{{ 'reports.project' | translate }}</div>
          <div class="flex-item">{{ 'reports.task' | translate }}</div>
          <div class="flex-item">{{ 'reports.start_time' | translate }}</div>
          <div class="flex-item">{{ 'reports.end_time' | translate }}</div>
          <div class="flex-item">{{ 'reports.duration' | translate }}</div>
          <div class="flex-item">{{ 'reports.trackCost' | translate }}</div>
          <div style="flex: 5%; width: 5%"></div>
        </div>
        <!-- ORDENADO POR USUARIO -->
        <div ng-repeat="tracks in tableTrackAuto" class="flex-column" style="color: black">
          <!-- ORDENADO POR PROYECTO -->
          <div ng-repeat="byProject in tracks.byProject" class="flex-column">
            <!-- TRACKS AUTOMATICOS -->
            <div ng-repeat="track in byProject.tracks track by $index" class="flex-column-wrap">
              <div class="flex-row">
                <div class="flex-item">{{track.usersName}}</div>
                <div class="flex-item">{{track.client}}</div>
                <div class="flex-item">{{track.projectError}}</div>
                <div class="flex-item">
                  {{track.error | truncateTail:true:20:'...'}}
                </div>
                <div class="flex-item">
                  {{track.startTime | date:'dd/MM/yyyy HH:mm' }}
                </div>
                <div class="flex-item">
                  {{track.endTime ? track.endTime : '' | date:'dd/MM/yyyy
                  HH:mm' }}
                </div>
                <div class="flex-item">{{track.durations}}</div>
                <div class="flex-item">$ {{track.trackCost}}</div>
                <div style="flex: 5%; width: 5%">
                  <a href="" ng-click="editAutoTrack(track)">
                    <i class="ri-pencil-line"></i>
                  </a>
                </div>
              </div>
              <!-- SUBTOTAL POR PROYECTO -->
              <div class="flex-row" ng-if="$index == byProject.tracks.length - 1 && !filter.idProject"
                style="background-color: #F9F9F9f0069; font-weight: bold">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{byProject.projectName | truncateTail:true:20:'...'}}
                </div>
                <div class="flex-item">{{byProject.duration}}</div>
                <div class="flex-item">$ {{byProject.subTotalCost}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div>
          <!-- SUBTOTAL POR USUARIO -->
          <div class="flex-column" ng-if="userRole=='admin' || userRole == 'pm' && !filter.idUser ">
            <div class="flex-column-wrap">
              <div class="flex-row" style="
                    background-color: rgba(60, 144, 190, 0.1);
                    font-weight: bold;
                  ">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{ 'reports.sub_total' | translate | uppercase }}
                </div>
                <div class="flex-item">{{tracks.duration}}</div>
                <div class="flex-item">$ {{tracks.subTotalCost}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex-column">
          <div class="flex-column-wrap">
            <div class="flex-row" style="
                  background-color: rgba(59, 144, 190, 0.43);
                  font-weight: bold;
                ">
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item">
                {{ 'reports.total.toFixed(2)' | translate | uppercase }}
              </div>
              <div class="flex-item">{{total2}}</div>
              <div class="flex-item">$ {{totalcost2}}</div>
              <div style="flex: 5%; width: 5%"></div>
            </div>
          </div>
        </div>
      </div>
      <!--  <table ng-if="tableTrackAuto.length" id="datatable" style="display: none;">
        <thead>
            <tr>
                <th>{{ 'reports.user' | translate }}</th>
                <th>{{ 'reports.client' | translate }}</th>
                <th>{{ 'reports.project' | translate }}</th>
                <th>{{ 'reports.task' | translate }}</th>
                <th>{{ 'reports.start_time' | translate }}</th>
                <th>{{ 'reports.end_time' | translate }}</th>
                <th>{{ 'reports.duration' | translate }}</th>
                <th>{{ 'reports.trackCost' | translate }}</th>
                <th class="imm-cstm__grid-5"></th>
            </tr>
        </thead>
        <tbody ng-repeat="tracksAuto in tableTrackAuto track by $index">
            <tr ng-repeat="trackAuto in tracksAuto.tracks"
                ng-class="{'active-task': !trackAuto.endTime || trackAuto.endTime == '0000-00-00 00:00:00'}"
                >
                <td>{{trackAuto.usersName}}</td>
                <td>LexartLabs</td>
                <td>{{trackAuto.projectError}}</td>
                <td>{{trackAuto.error}}</td>
                <td>{{trackAuto.startTime | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>{{trackAuto.endTime ? trackAuto.endTime : '' | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>{{trackAuto.durations}}</td>
                <td>$ {{trackAuto.trackCost}}</td>
                <td>
                    <a href="" ng-click="editAutoTrack(trackAuto)">
                        <i class="ri-edit-line"></i>
                    </a>
                </td>
            </tr>
            <tr style="background-color: rgba(60, 144, 190, 0.1); font-weight: bold;">
                <td colspan="5"></td>
                <td>{{ 'reports.sub_total' | translate | uppercase }}</td>
                <td>{{tracksAuto.duration}}</td>
                <td>$ {{tracksAuto.subTotalCost}}</td >
                <td></td>
            </tr>
        </tbody>
        <tbody>
            <tr style="background-color: rgba(104, 149, 191, 0.4); font-weight: bold;">
                <td colspan="5"></td>
                <td>{{ 'reports.total' | translate | uppercase }}</td>
                <td>{{total2}}</td>
                <td>$ {{totalcost2}}</td>
                <td></td>
            </tr>
        </tbody>
    </table> -->
    </div>

    <!-- End Table -->
    <div ng-if="itemTab == 1">
      <br />
      <a class="imm-bc-item" ng-if="trelloTracks.length > 0">{{ 'reports.titleTrello' | translate }}</a>
      <br /><br />
    </div>

    <div class="imm-flex" ng-if="itemTab == 1">
      <div class="flex-table" ng-if="tableTrackTrello.length > 0">
        <div class="flex-head">
          <div class="flex-item">{{ 'reports.user' | translate }}</div>
          <div class="flex-item">{{ 'reports.client' | translate }}</div>
          <div class="flex-item">{{ 'reports.project' | translate }}</div>
          <div class="flex-item">{{ 'reports.task' | translate }}</div>
          <div class="flex-item">{{ 'reports.start_time' | translate }}</div>
          <div class="flex-item">{{ 'reports.end_time' | translate }}</div>
          <div class="flex-item">{{ 'reports.duration' | translate }}</div>
          <div class="flex-item">{{ 'reports.trackCost' | translate }}</div>
          <div style="flex: 5%; width: 5%"></div>
        </div>
        <!-- ORDENADO POR USUARIO -->
        <div ng-repeat="tracks in tableTrackTrello" class="flex-column" style="color: black">
          <!-- ORDENADO POR PROYECTO -->
          <div ng-repeat="byProject in tracks.byProject" class="flex-column">
            <!-- TRACKS TRELLO -->
            <div ng-repeat="track in byProject.tracks track by $index" class="flex-column-wrap">
              
              <div class="flex-row">
                <div class="flex-item">{{track.usersName}}</div>
                <div class="flex-item">{{track.client}}</div>
                <div class="flex-item">{{track.projectName}}</div>
                <div class="flex-item">
                  {{track.name | truncateTail:true:20:'...'}}
                </div>
                <div class="flex-item">
                  {{track.startTime | date:'dd/MM/yyyy HH:mm' }}
                </div>
                <!-- <div class="flex-item">
                    {{track.endTime ? track.endTime : '' | date:'dd/MM/yyyy
                    HH:mm' }}
                  </div> -->
                <div class="flex-item">
                  {{track.endTime ? track.endTime : '' | date:'dd/MM/yyyy HH:mm'}}
                </div>
                <div class="flex-item">{{track.durations}}</div>
                <div class="flex-item">{{track.currency}} {{track.trackCost}}</div>
                <div style="flex: 5%; width: 5%">
                  <a href="" ng-click="editTrelloTrack(track)">
                    <i class="ri-pencil-line"></i>
                  </a>
                </div>
              </div>
              <!-- SUBTOTAL POR PROYECTO -->
              <div class="flex-row" ng-if="$index == byProject.tracks.length - 1 && !filter.idProject"
                style="background-color: #F9F9F9f0069; font-weight: bold">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{byProject.projectName | truncateTail:true:20:'...'}}
                </div>
                <div class="flex-item">{{byProject.duration}}</div>
                <div class="flex-item">{{tracks.currency}} {{byProject.subTotalCost}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div>
          <!-- SUBTOTAL POR USUARIO -->
          <div class="flex-column" ng-if="userRole=='admin' || userRole == 'pm' && !filter.idUser">
            <div class="flex-column-wrap">
              <div class="flex-row" style="
                    background-color: rgba(60, 144, 190, 0.1);
                    font-weight: bold;
                  ">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{ 'reports.sub_total' | translate | uppercase }}
                </div>
                <div class="flex-item">{{tracks.duration}}</div>
                <div class="flex-item">{{tracks.currency}} {{tracks.subTotalCost}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div>

          <!-- <div class="flex-column">
            <div class="flex-column-wrap">
              <div class="flex-row" style="
                  background-color: rgba(59, 144, 190, 0.43);
                  font-weight: bold;
                ">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{ 'reports.total' | translate | uppercase }}
                </div>
                <div class="flex-item">{{total3}}</div>
                <div class="flex-item">{{tracks.currency}} {{totalcost3}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div> -->
        </div>
      </div>
      <!--  <table ng-if="tableTrackTrello.length" id="datatable">
        <thead>
            <tr>
                <th>{{ 'reports.user' | translate }}</th>
                <th>{{ 'reports.client' | translate }}</th>
                <th>{{ 'reports.project' | translate }}</th>
                <th>{{ 'reports.task' | translate }}</th>
                <th>{{ 'reports.start_time' | translate }}</th>
                <th>{{ 'reports.end_time' | translate }}</th>
                <th>{{ 'reports.duration' | translate }}</th>
                <th>{{ 'reports.trackCost' | translate }}</th>
                <th class="imm-cstm__grid-5"></th>
            </tr>
        </thead>
        <tbody ng-repeat="tracksTrello in tableTrackTrello track by $index">
            <tr ng-repeat="trackTrello in tracksTrello.tracks"
                ng-class="{'active-task': !trackTrello.endTime || trackTrello.endTime == '0000-00-00 00:00:00'}"
                >
                <td>{{trackTrello.usersName}}</td>
                <td>{{trackTrello.client}}</td>
                <td>{{trackTrello.projectName}}</td>
                <td>{{trackTrello.name}}</td>
                <td>{{trackTrello.startTime | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>{{trackTrello.endTime ? trackTrello.endTime : '' | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>{{trackTrello.durations}}</td>
                <td>$ {{trackTrello.trackCost}}</td>
                <td>
                    <a href="" ng-click="editTrelloTrack(trackTrello)">
                        <i class="ri-edit-line"></i>
                    </a>
                </td>
            </tr>
            <tr style="background-color: rgba(60, 144, 190, 0.1); font-weight: bold;">
                <td colspan="5"></td>
                <td>{{ 'reports.sub_total' | translate | uppercase }}</td>
                <td>{{tracksTrello.duration}}</td>
                <td>$ {{tracksTrello.subTotalCost}}</td >
                <td></td>
            </tr>
        </tbody>
        <tbody>
            <tr style="background-color: rgba(104, 149, 191, 0.4); font-weight: bold;">
                <td colspan="5"></td>
                <td>{{ 'reports.total' | translate | uppercase }}</td>
                <td>{{total3}}</td>
                <td>$ {{totalcost3}}</td>
                <td></td>
            </tr>
        </tbody>
    </table> -->
    </div>

  

    <div ng-if="itemTab == 1">
      <br />
      <a class="imm-bc-item" ng-if="jiraTracks.length > 0">{{ 'Tareas Jira' }}</a>
      <br /><br />
    </div>

    <div class="imm-flex" ng-if="itemTab == 1">
      <div class="flex-table" ng-if="jiraTracks.length > 0">
        <div class="flex-head">
          <div class="flex-item">{{ 'reports.user' | translate }}</div>
          <div class="flex-item">{{ 'reports.client' | translate }}</div>
          <div class="flex-item">{{ 'reports.project' | translate }}</div>
          <div class="flex-item">{{ 'reports.task' | translate }}</div>
          <div class="flex-item">{{ 'reports.start_time' | translate }}</div>
          <div class="flex-item">{{ 'reports.end_time' | translate }}</div>
          <div class="flex-item">{{ 'reports.duration' | translate }}</div>
          <div class="flex-item">{{ 'reports.trackCost' | translate }}</div>
          <div style="flex: 5%; width: 5%"></div>
        </div>
        <!-- ORDENADO POR USUARIO -->
        <div ng-repeat="tracks in tableTrackJira" class="flex-column" style="color: black">
          <!-- ORDENADO POR PROYECTO -->
          <div ng-repeat="byProject in tracks.byProject" class="flex-column">
            <!-- TRACKS AUTOMATICOS -->
            <div ng-repeat="track in byProject.tracks track by $index" class="flex-column-wrap">
              <div class="flex-row">
                <div class="flex-item">{{track.usersName}}</div>
                <div class="flex-item">{{track.client}}</div>
                <div class="flex-item">{{track.projectName}}</div>
                <div class="flex-item">
                  {{track.name | truncateTail:true:20:'...'}}
                </div>
                <div class="flex-item">
                  {{track.startTime | date:'dd/MM/yyyy HH:mm' }}
                </div>
                <div class="flex-item">
                  {{track.endTime ? track.endTime : '' | date:'dd/MM/yyyy
                  HH:mm' }}
                </div>
                <div class="flex-item">{{track.durations}}</div>
                <div class="flex-item">$ {{track.trackCost}}</div>
                <div style="flex: 5%; width: 5%">
                  <a href="" ng-click="editJiraTrack(track)">
                    <i class="ri-pencil-line"></i>
                  </a>
                </div>
              </div>
              <!-- SUBTOTAL POR PROYECTO -->
              <div class="flex-row" ng-if="$index == byProject.tracks.length - 1 && !filter.idProject"
                style="background-color: #F9F9F9f0069; font-weight: bold">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{byProject.projectName | truncateTail:true:20:'...'}}
                </div>
                <div class="flex-item">{{byProject.duration}}</div>
                <div class="flex-item">$ {{byProject.subTotalCost}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div>
          <!-- SUBTOTAL POR USUARIO -->7
          <div class="flex-column" ng-if="userRole=='admin' || userRole == 'pm' && !filter.idUser ">
            <div class="flex-column-wrap">
              <div class="flex-row" style="
                    background-color: rgba(60, 144, 190, 0.1);
                    font-weight: bold;
                  ">
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item"></div>
                <div class="flex-item">
                  {{ 'reports.sub_total' | translate | uppercase }}
                </div>
                <div class="flex-item">{{tracks.duration}}</div>
                <div class="flex-item">$ {{tracks.subTotalCost}}</div>
                <div style="flex: 5%; width: 5%"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex-column">
          <div class="flex-column-wrap">
            <div class="flex-row" style="
                  background-color: rgba(59, 144, 190, 0.43);
                  font-weight: bold;
                ">
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item"></div>
              <div class="flex-item">
                {{ 'reports.total' | translate | uppercase }}
              </div>
              <div class="flex-item">{{total4}}</div>
              <div class="flex-item">$ {{totalcost4}}</div>
              <div style="flex: 5%; width: 5%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    
    <div class="imm-wa__hdr imm-flex">
      <div class="imm-flex-5">
        <table style="max-width:40%; white-space:nowrap; float:right"
          ng-if="tableTrack.length || tableTrackTrello.length">
          <tr style="font-weight: bold; ">
            <td></td>
            <td>{{ 'reports.duration' | translate | uppercase}}</td>
            <td>$</td>
            <td>R$</td>
            <td>USD</td>
          </tr>
          <tr>
            <td>{{ 'reports.manual' | translate}}</td>
            <td>{{total}}</td>
            <td>{{totalCostManualPesos.toFixed(2)}}</td>
            <td>{{totalCostManualReales.toFixed(2)}}</td>
            <td>{{totalCostManualDolares.toFixed(2)}}</td>
          </tr>
          <tr>
            <td>{{ 'reports.trello' | translate}}</td>
            <td>{{total3}}</td>
            <td>{{totalCostTrelloPesos.toFixed(2)}}</td>
            <td>{{totalCostTrelloReales.toFixed(2)}}</td>
            <td>{{totalCostTrelloDolares.toFixed(2)}}</td>
          </tr>
          <tr style="background-color: rgba(59, 144, 190, 0.43); font-weight: bold; ">
            <td>{{ 'reports.total' | translate | uppercase}}</td>
            <td>{{totalDuration}}</td>
            <td>{{totalCostPesos.toFixed(2)}}</td>
            <td>{{totalCostReales.toFixed(2)}}</td>
            <td>{{totalCostDolares.toFixed(2)}}</td>
          </tr>



        </table>
      </div>
    </div>
    <!-- <div ng-if="itemTab == 1">
        <div
          ng-if="tableTrack.length > 0 || tableTrackAuto.length > 0 || tableTrackTrello.length > 0 || tableTrackJira.length > 0"
          style="
            text-align: left;
            background-color: rgba(16, 192, 0, 0.4);
            margin-top: 2%;
            font-weight: bold;
            padding-left: 73%;
            padding-top: 6px;
            font-size: 11px;
          "
        >
          TOTAL HORAS: {{finalHour}}
        </div>
        <div
          ng-if="tableTrack.length > 0 || tableTrackAuto.length > 0 || tableTrackTrello.length > 0 || tableTrackJira.length > 0"
          style="
            text-align: left;
            background-color: rgba(16, 192, 0, 0.4);
            font-weight: bold;
            padding-left: 73%;
            padding-bottom: 5px;
            font-size: 11px;
          "
        >
          TOTAL COSTO: $ {{(arrCost).toFixed(2)}}
        </div>

      </div> -->

    <div class="imm-cstm__grid-90">
      <div ng-if="itemTab == 2">
        <!-- Graph tabs -->
        <div class="imm-frm__fld">
          <ul class="imm-tabs" ng-init="graphicTab = 1">
            <li class="imm-tabs__item" ng-click="graphicTab = 1"
              ng-class="{'imm-tabs__item--selected' : graphicTab == 1}">
              Usuarios
            </li>
            <li class="imm-tabs__item" ng-click="graphicTab = 2"
              ng-class="{'imm-tabs__item--selected' : graphicTab == 2}">
              Clientes
            </li>
          </ul>
        </div>
        <!--End graph tabs-->
        <!-- Bar Graph User-->
        <div ng-if="graphicTab == 1">
          <div class="imm-frm__fldgrp">
            <div class="imm-frm__fld">
              <div class="imm-tit">
                <h2 class="imm-wa__tit">
                  <a class="imm-bc-item">{{ 'reports.users' | translate }}</a>
                </h2>
              </div>
              <canvas height="80" id="base" class="chart-base" chart-type="typeBarUser" chart-data="dataBarUsers"
                chart-labels="labelsBarUsers">
              </canvas>
            </div>
          </div>
          <!-- Round End Graph -->
        </div>

        <!-- Bar Graph Clients-->
        <div ng-if="graphicTab == 2">
          <div class="imm-frm__fldgrp">
            <div class="imm-frm__fld">
              <div class="imm-tit">
                <h2 class="imm-wa__tit">
                  <a class="imm-bc-item">{{ 'reports.clients' | translate }}</a>
                </h2>
              </div>
              <canvas height="80" id="base" class="chart-base" chart-type="typeBarClient" chart-data="dataBarClients"
                chart-labels="labelsBarClients">
              </canvas>
            </div>
          </div>
        </div>
        <!-- Round End Graph -->
      </div>
    </div>
    <!-- End Bar Graph -->
  </div>
</div>
</div>

<div ng-if="tabReport == 2">
  <div class="imm-wa__hdr imm-flex" style="margin-top: 10px">
    <div class="imm-flex-5">
      <h1 class="imm-wa__tit">
        <a class="imm-bc-item">Reportes Proyectos</a>
      </h1>
      <button class="imm-btn" ng-if="tracks.length" ng-click="exportToCSV()">
        Descargar CSV
      </button>
    </div>
  </div>
  <div class="imm-wa__cnt">
    <div class="imm-flex">
      <table ng-if="projectsTab.length">
        <thead>
          <tr>
            <th>{{ 'reports.idProject' | translate }}</th>
            <th>{{ 'reports.project' | translate }}</th>
            <th>{{ 'reports.description' | translate }}</th>
            <th>{{ 'reports.client' | translate }}</th>
            <th>{{ 'reports.duration' | translate }}</th>
            <th>{{ 'reports.tracked' | translate }}</th>
            <th>{{ 'reports.totalCost' | translate }}</th>
            <th>{{ 'reports.presupuesto' | translate }}</th>
            <th class="imm-cstm__grid-5"></th>
          </tr>
        </thead>
        <tr>
          <td><input class="field-filter" ng-model="filtername.id" /></td>
          <td><input class="field-filter" ng-model="filtername.name" /></td>
          <td>
            <input class="field-filter" ng-model="filtername.description" />
          </td>
          <td>
            <input class="field-filter" ng-model="filtername.clientName" />
          </td>
          <td><input class="field-filter" ng-model="filtername.duration" /></td>
          <td><input class="field-filter" ng-model="filtername.tracked" /></td>
          <td>
            <input class="field-filter" ng-model="filtername.totalCost" />
          </td>
          <td>
            <input class="field-filter" ng-model="filtername.presupuesto" />
          </td>
          <td></td>
        </tr>
        <tr ng-repeat="projectsAll in projectsTab">
          <td>{{projectsAll.id }}</td>
          <td>{{projectsAll.name | truncateTail:true:20:'...'}}</td>
          <td>{{projectsAll.description | truncateTail:true:50:'...'}}</td>
          <td>{{projectsAll.clientName | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>{{projectsAll.duration}}</td>
          <td>{{projectsAll.tracked | truncateTail:true:10:'...'}}</td>
          <td>$ {{projectsAll.totalCost}}</td>
          <td>$ {{projectsAll.presupuesto}}</td>
          <td></td>
        </tr>
      </table>
    </div>
  </div>
  <paging ng-show="totalTab>pageSize" page="currentPage" page-size="pageSize" total="totalTab" hide-if-empty="true"
    show-prev-next="true" show-first-last="true" scroll-top="true" paging-action="pager(page)">
  </paging>
</div>

<div ng-if="userRole == 'admin'">
  <table class="imm-table">
    <tr>
      <th>Cliente</th>
      <th>Horas Desarollo</th>
      <th>Cliente Budget</th>
      <th>Diferencia</th>
    </tr>
    <tr ng-repeat="(key, value) in clientTotalDev">
      <td>{{ key }}</td>
      <td>
        {{ value.totalDolares | currency:"USD$" }}
        <br>
        {{ value.totalReales | currency:"R$" }}
        <br>
        {{ value.totalPesos | currency:"$" }}
      </td>
      <td>
        {{ (clientTotals[key].totalDolares || 0) | currency:"USD$" }}
        <br>
        {{ (clientTotals[key].totalReales || 0) | currency:"R$" }}
        <br>
        {{ (clientTotals[key].totalPesos || 0) | currency:"$" }}
      </td>
      <td>
        {{
          (clientTotals[key].totalDolares || 0) - value.totalDolares | currency:"USD$"
        }}
        <br>
        {{
          (clientTotals[key].totalReales || 0) - value.totalReales | currency:"R$"
        }}
        <br>
        {{
          (clientTotals[key].totalPesos || 0) - value.totalPesos | currency:"$"
        }}
      </td>
    </tr>
  </table>
</div>